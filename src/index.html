<!DOCTYPE html>

<link rel="stylesheet" type="text/css" href="index.css">


<link href="https://unpkg.com/tabulator-tables@4.7.2/dist/css/tabulator.min.css" rel="stylesheet">
<script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.7.2/dist/js/tabulator.min.js"></script>
<script src="js/chart.js"></script>
<script src="js/aesthetics.js"></script>
<html>
    <body>
        <!----><div id="pre-folder-items">
            <div id="buttons" style="width:100%;text-align:center;">
                <button id="picker-button" onclick="document.getElementById('file-picker').click();">Select Stats Folder</button>
                <button id="picker-button" onclick="myWorker.postMessage(load_samples());">Load Sample Stats</button>
            </div>

            <div id='footnote'>
                <hr>
                <p id='selectfiles'>
                    <sup>1</sup> For most users, this folder will be located in "C:\Program Files (x86)\Steam\steamapps\common\FPSAimTrainer\FPSAimTrainer\stats\" or "D:\SteamLibrary\steamapps\common\FPSAimTrainer\FPSAimTrainer\stats\".
                    <br/>
                    <sup>2</sup> Navigate to the folder mentioned above, then, once inside, press the 'Upload' button.
                    <br/>
                    <sup>3</sup> For the best results use either Chrome or Firefox.
                </p>
            </div>

            <br/>
            <input id="file-picker" type="file" directory multiple webkitdirectory></input>
        </div>


        <div id="post-folder-items" style="width:100%; height:100%;visibility:hidden;">
            <div id="container1">
                <table>
                    <tr>
                        <td>
                            <select id="chart1-select" onchange="update_charts();">
                                <option value="Score" selected hidden>Score</option>
                                <option value="Accuracy">Accuracy</option>
                                <option value="True Score">True Score</option>
                            </select>
                            <!-- TDODO: Add a feature to add another option to a single graph, so that you can stack things -->
                        </td>
                    </tr>
                    <tr id="blank_row"><td colspan="1"></td></tr>
                    <tr>
                        <td>
                            <div id="chart-container">
                                <canvas id="chart1"></canvas>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div id="container2">
                <table>
                    <tr>
                        <td>
                            <select id="chart2-select" onchange="update_charts();">
                                <option value="Score">Score</option>
                                <option value="Accuracy" selected hidden>Accuracy</option>
                                <option value="True Score">True Score</option>
                            </select>
                        </td>
                    </tr>
                    <tr id="blank_row"><td colspan="1"></td></tr>
                    <tr>
                        <td>
                            <div id="chart-container">
                                <canvas id="chart2"></canvas>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div id="container3">
                <table>
                    <tr>
                        <td>
                            <select id="chart3-select" onchange="update_charts();">
                                <option value="Score">Score</option>
                                <option value="Accuracy">Accuracy</option>
                                <option value="True Score" selected hidden>True Score</option>
                            </select>
                        </td>
                    </tr>
                    <tr id="blank_row"><td colspan="1"></td></tr>
                    <tr>
                        <td>
                            <div id="chart-container">
                                <canvas id="chart3"></canvas>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div id="container4">
                <div style="flex-grow:1; background-color: rgba(0, 255, 0, 0.2); height:10%;">
                    <select id="dropdown" onchange="update_chart();">
                        <option value="Select Scenario" selected disabled hidden>
                            Waiting to Load Files
                        </option>
                    </select>
                    <button id="toggle-max" onclick="toggle_max_state();">Scale From Zero: On</button>
                    <button id="toggle-scale" onclick="toggle_scaling();">Score Axis Scale: Linear</button>
                </div>

                <div id="data-table" style="flex-grow:1; background-color: rgba(255, 0, 0, 0.2); height:90%;">
                </div>
            </div>
        </div>
    </body>
</html>

<!-- Start up the worker after the screen is displayed -->
<script>
    // create_chart();

    window.localStorage.clear()
    if(window.Worker) {
        var myWorker = new Worker('js/worker.js');

        myWorker.onmessage = e => {
            // This function executes after we RECEIVE a message from the worker
            if(e.data.Error != null) {
                document.getElementById('file-picker').value = '';
                alert(e.data.ErrorMessage);
            } else {
                // TODO: Add other error checking in worker.js to make sure all of the files process fine.
                //       This will really just boil down to a try-catch and returning error if an error is caught
                post_file_collection();
                create_chart();

                var unique_challenges = e.data.unique_challenges;
                var challenge_data = e.data.challenge_data;

                window.localStorage.setItem('unique_challenges', JSON.stringify(unique_challenges));
                window.localStorage.setItem('challenge_data',  JSON.stringify(challenge_data));

                update_dropdown();
            }
        };

        let picker = document.getElementById('file-picker');
        picker.addEventListener('change', e => {
            myWorker.postMessage(Array.from(e.target.files));
        });
    } else {
        alert("Your browser doesn\'t support web workers. Try using Chrome instead.");
    }
</script>
